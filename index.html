<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>æ±äº¬æ«»èŠ± 2026 Pro v6.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --main-pink: #ffb6c1;
        --bg-pink: #fff5f7;
      }
      body {
        background-color: var(--bg-pink);
        font-family: -apple-system, sans-serif;
        padding-bottom: 120px;
        color: #4a4a4a;
      }
      .card {
        background: white;
        border-radius: 18px;
        padding: 18px;
        border-left: 8px solid #ddd;
        box-shadow: 0 4px 12px rgba(255, 182, 193, 0.1);
        cursor: pointer;
        position: relative;
      }
      .card-spot { border-left-color: var(--main-pink); }
      .card-restaurant { border-left-color: #ff9800; }
      .card-transport { border-left-color: #9ca3af; }
      
      .personal-note-preview {
        background: #f0f7ff;
        color: #1e40af;
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 0.75rem;
        margin-top: 8px;
        border-left: 3px solid #3b82f6;
        font-style: italic;
      }
      .popup-bg {
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: end;
        position: fixed;
        inset: 0;
        z-index: 1000;
      }
      .popup-bg.active { display: flex; }
      .popup-content {
        transform: translateY(100%);
        transition: 0.3s cubic-bezier(0.17, 0.84, 0.44, 1);
        background: white;
        width: 100%;
        border-radius: 30px 30px 0 0;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
      }
      .popup-bg.active .popup-content { transform: translateY(0); }
      .popup-header-img {
        width: 100%;
        height: 220px;
        object-fit: cover;
        border-radius: 30px 30px 0 0;
        background-color: #e5e7eb;
      }
      .img-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 220px;
        background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.7));
        border-radius: 30px 30px 0 0;
        pointer-events: none;
      }
      .input-style {
        width: 100%;
        background: #f3f4f6;
        border: none;
        border-radius: 12px;
        padding: 12px;
        font-size: 0.95rem;
        margin-bottom: 15px;
        outline: none;
      }
      .view-label {
        font-size: 0.7rem;
        font-weight: bold;
        color: #bbb;
        text-transform: uppercase;
        margin-bottom: 4px;
        display: block;
      }
      .map-btn {
        background: #e8f5e9;
        color: #2e7d32;
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 4px;
        border: 1px solid #c8e6c9;
      }
    </style>
  </head>
  <body class="p-5">
    <header class="flex justify-between items-start mb-6">
      <div>
        <h1 class="text-2xl font-bold text-pink-600">ğŸŒ¸ æ±äº¬æ«»èŠ± 2026</h1>
        <p class="text-xs text-pink-400">Word è³‡æ–™åŒæ­¥ç‰ˆ v6.0</p>
      </div>
      <div class="flex flex-col gap-2 text-right">
        <button
          onclick="toggleJSON()"
          class="bg-indigo-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm"
        >
          å‚™ä»½/åŒæ­¥
        </button>
      </div>
    </header>

    <div id="app"></div>

    <div id="viewPopup" class="popup-bg" onclick="closePopups()">
      <div class="popup-content pb-10" onclick="event.stopPropagation()">
        <div class="relative">
          <img id="vImg" src="" class="popup-header-img" onerror="this.src='https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=800'"/>
          <div class="img-overlay"></div>
          <div class="absolute bottom-4 left-6 right-6 flex justify-between items-end">
            <div>
              <h2 id="vTitle" class="text-2xl font-bold text-white shadow-lg"></h2>
            </div>
            <a id="vMapLink" href="#" target="_blank" class="bg-white text-green-600 px-4 py-2 rounded-full font-bold shadow-lg flex items-center gap-2">
              <i class="fas fa-map-marked-alt"></i> æŸ¥çœ‹åœ°åœ–
            </a>
          </div>
        </div>
        <div class="p-6 space-y-5">
          <div class="flex items-center gap-4">
            <div class="flex-1 border-r border-gray-100">
              <p class="view-label">â° é è¨ˆæ™‚é–“</p>
              <p id="vTime" class="text-lg font-bold text-pink-600"></p>
            </div>
            <div class="flex-1 pl-4">
              <p class="view-label">ğŸ¨ åˆ†é¡</p>
              <p id="vTypeDisp" class="text-lg font-medium text-gray-500"></p>
            </div>
          </div>
          <div>
            <p class="view-label">ğŸ“œ ä»‹ç´¹/å‚™è¨»</p>
            <p id="vDesc" class="text-gray-600 leading-relaxed text-sm"></p>
          </div>
          <div id="vPersonalBox" class="bg-blue-50 p-4 rounded-2xl">
            <p class="view-label text-blue-300">ğŸ’¡ å€‹äººå‚™è¨» (ä¾†è‡ª Word)</p>
            <p id="vPersonal" class="text-blue-800 italic text-sm"></p>
          </div>
          <button onclick="closePopups()" class="w-full mt-4 bg-gray-800 text-white py-4 rounded-2xl font-bold">é—œé–‰</button>
        </div>
      </div>
    </div>

    <div id="editPopup" class="popup-bg" onclick="closePopups()">
      <div class="popup-content p-6" onclick="event.stopPropagation()">
        <h2 class="text-xl font-bold mb-4">ç·¨è¼¯è¡Œç¨‹</h2>
        <label class="view-label">ğŸ–¼ï¸ åœ–ç‰‡ç¶²å€</label>
        <input type="text" id="eImg" class="input-style" placeholder="è²¼ä¸Šç¶²å€"/>
        <label class="view-label">ğŸ—ºï¸ Google Map é€£çµ</label>
        <input type="text" id="eMap" class="input-style" placeholder="http://googleusercontent.com/maps.google.com/..."/>
        <label class="view-label">ğŸ“ åç¨±</label>
        <input type="text" id="eTitle" class="input-style font-bold" />
        <div class="flex gap-3">
          <div class="flex-1">
            <label class="view-label">â° æ™‚é–“</label>
            <input type="text" id="eTime" class="input-style" />
          </div>
          <div class="flex-1">
            <label class="view-label">ğŸ¨ åˆ†é¡</label>
            <select id="eType" class="input-style">
              <option value="spot">ğŸ›ï¸ æ™¯é»</option>
              <option value="restaurant">ğŸ´ é¤å»³</option>
              <option value="transport">ğŸš— äº¤é€š</option>
            </select>
          </div>
        </div>
        <label class="view-label">ğŸ“œ ä»‹ç´¹</label>
        <textarea id="eDesc" class="input-style h-16"></textarea>
        <label class="view-label">ğŸ’¡ å€‹äººå‚™è¨»</label>
        <textarea id="ePersonal" class="input-style h-16"></textarea>
        <button onclick="saveChanges()" class="w-full bg-pink-500 text-white py-4 rounded-2xl font-bold">å„²å­˜</button>
      </div>
    </div>

    <div id="jsonPopup" class="popup-bg" onclick="toggleJSON()">
      <div class="popup-content p-6" onclick="event.stopPropagation()">
        <h2 class="text-xl font-bold mb-4">æ•¸æ“šç®¡ç†</h2>
        <textarea id="jsonInput" class="w-full h-80 border p-3 text-[10px] font-mono bg-gray-50 rounded-lg mb-4"></textarea>
        <button onclick="importData()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold">æ›´æ–°æ•¸æ“š</button>
      </div>
    </div>

    <script>
      let editingIndices = { d: 0, i: 0 };
      const iconMap = { spot: "ğŸ›ï¸", restaurant: "ğŸ´", transport: "ğŸš—" };
      const typeLabel = { spot: "æ™¯é»", restaurant: "é¤å»³", transport: "äº¤é€š" };

      const tripDataTemplate = [
        {
          day: 1,
          date: "2026-03-14",
          items: [
            { time: "11:00", type: "transport", title: "æŠµé”ç¾½ç”°æ©Ÿå ´", map: "https://www.google.com/maps/place/%E6%9D%B1%E4%BA%AC%E5%9C%8B%E9%9A%9B%E6%A9%9F%E5%A0%B4(%E7%BE%BD%E7%94%B0%E6%A9%9F%E5%A0%B4)/@35.5477009,139.7684885,15z/data=!3m1!4b1!4m6!3m5!1s0x6018640ba43192e3:0xd32c3a9d146f8df!8m2!3d35.5482964!4d139.7779951!16zL20vMDFubG1t?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "æŠµé”æ±äº¬ã€‚", personal: "" },
            { time: "15:00", type: "spot", title: "å…¥ä½ HOTEL CLAD", map: "https://www.google.com/maps?cid=7316536174472237467", img: "", desc: "æ­ä¹˜å·´å£«å‰å¾€ã€‚", personal: "ä½æ–¼å¾¡æ®¿å ´ã€‚" },
            { time: "16:00", type: "spot", title: "å¾¡æ®¿å ´ Outlet", map: "https://www.google.com/maps?cid=5814346422745768836", img: "", desc: "æ­¥è¡Œå‰å¾€ã€‚", personal: "" }
          ]
        },
        {
          day: 2,
          date: "2026-03-15",
          items: [
            { time: "09:00", type: "transport", title: "Toyota Rent a Car (ç§Ÿè»Š)", map: "https://www.google.com/maps/place/Toyota+Rent+a+Car/@35.2992146,138.9327102,17z/data=!3m1!4b1!4m6!3m5!1s0x60197645ac54786f:0x10aa16a984b77dfb!8m2!3d35.2992146!4d138.9327102!16s%2Fg%2F1tfd70dc?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "æ­ä¹˜è¨ˆç¨‹è»Šå‰å¾€ã€‚", personal: "" },
            { time: "10:30", type: "spot", title: "å±±ä¸­æ¹– - å¹³é‡ä¹‹æ¿±", map: "https://www.google.com/maps/place/%E5%B9%B3%E9%87%8E%E4%B9%8B%E6%BF%B1/@35.4247045,138.8982488,17z/data=!3m1!4b1!4m6!3m5!1s0x60196fec8ed01c37:0xaea15f41d50a234a!8m2!3d35.4247002!4d138.9008237!16s%2Fg%2F11nn1rs839?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "é–‹è»Šå‰å¾€ã€‚", personal: "" },
            { time: "11:30", type: "restaurant", title: "THE PARK é¬†é¤… / è¦ªæ°´å…¬åœ’", map: "https://www.google.com/maps/place/%E9%95%B7%E6%B1%A0%E8%A6%AA%E6%B0%B4%E5%85%AC%E5%9C%92+%E8%A5%BF%E4%B9%97%E7%94%A8%E8%BB%8A%E9%A7%90%E8%BB%8A%E5%A0%B4+(%E5%A4%A7%E5%B9%B3%E5%B1%B1%E3%83%BB%E7%9F%B3%E5%89%B2%E5%B1%B1+%E7%99%BB%E5%B1%B1%E5%8F%A3)/@35.4270612,138.8700507,18z/data=!4m6!3m5!1s0x601965939af46db3:0x7b015c3a03ce0fa!8m2!3d35.4271623!4d138.870261!16s%2Fg%2F11qn5wkdq3?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "æ­¥è¡Œã€‚", personal: "" },
            { time: "13:00", type: "spot", title: "æ—¥å·æ™‚è¨ˆåº—", map: "https://www.google.com/maps/place/Fujiyoshida+Shiei+Honmachidori+Parking+Lot/@35.4923866,138.8019421,17z/data=!4m10!1m2!2m1!1z5YGc6LuK5aC0!3m6!1s0x601967343b160537:0xdbcf1faff554a9d5!8m2!3d35.4923145!4d138.80383!15sCgnlgZzou4rloLRaCyIJ5YGc6LuK5aC0kgELcGFya2luZ19sb3SaASRDaGREU1VoTk1HOW5TMFZKUTBGblNVUm9PV1kyYUMxUlJSQULgAQD6AQQIERAj!16s%2Fg%2F11crzw0qr2?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "å¯Œå£«å‰ç”°è¡—é“æ‹æ”é»ã€‚", personal: "" },
            { time: "14:30", type: "spot", title: "æ²³å£æ¹–å…¨æ™¯çºœè»Š", map: "https://www.google.com/maps/place/%E7%9C%8C%E5%96%B6+%E8%88%B9%E6%B4%A5%E6%B5%9C%E7%84%A1%E6%96%99%E9%A7%90%E8%BB%8A%E5%A0%B4/@35.5043743,138.769815,17.51z/data=!4m6!3m5!1s0x60195f0009dfb145:0x4a1fc0c03929b784!8m2!3d35.5038883!4d138.7701851!16s%2Fg%2F11lp2vkphz?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "æ­ä¹˜çºœè»Šæ¬£è³æ¹–æ™¯ã€‚", personal: "" },
            { time: "16:00", type: "spot", title: "Lawson æ²³å£æ¹–ç«™å‰åº—", map: "https://www.google.com/maps/search/Mt.+Fuji+Panoramic+Ropeway6", img: "", desc: "ç†±é–€è¶…å•†æ‰“å¡é»ã€‚", personal: "" },
            { time: "17:30", type: "restaurant", title: "ã»ã†ã¨ã†ä¸å‹• æ²³å£æ¹–åŒ—æœ¬åº—", map: "https://www.google.com/maps/search/Mt.+Fuji+Panoramic+Ropeway7", img: "", desc: "æ²³å£æ¹–åç”¢é¤ºé£¥éºµã€‚", personal: "" },
            { time: "19:00", type: "spot", title: "å¤§çŸ³å…¬åœ’", map: "https://www.google.com/maps/search/Mt.+Fuji+Panoramic+Ropeway8", img: "", desc: "æ¹–ç•”ç¾æ™¯ã€‚", personal: "" },
            { time: "20:00", type: "spot", title: "MaxValu å¾¡æ®¿å ´æ±ç”°ä¸­åº—", map: "https://www.google.com/maps/search/Mt.+Fuji+Panoramic+Ropeway9", img: "", desc: "è¶…å¸‚æ¡è²·ã€‚", personal: "" },
            { time: "21:30", type: "transport", title: "Toyota é‚„è»Š / å›é£¯åº—", map: "https://www.google.com/maps/place/Toyota+Rent+a+Car/@35.2992146,138.9327102,17z/data=!3m1!4b1!4m6!3m5!1s0x60197645ac54786f:0x10aa16a984b77dfb!8m2!3d35.2992146!4d138.9327102!16s%2Fg%2F1tfd70dc?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "çµæŸè‡ªé§•è¡Œç¨‹ï¼Œè¿”å› HOTEL CLADã€‚", personal: "" }
          ]
        },
        {
          day: 3,
          date: "2026-03-16",
          items: [
            { time: "09:30", type: "transport", title: "é£¯åº— Checkout", map: "https://www.google.com/maps?cid=7316536174472237467", img: "", desc: "é›¢é–‹ HOTEL CLADã€‚", personal: "" },
            { time: "10:00", type: "spot", title: "å¾¡æ®¿å ´ Outlet (å«åˆé¤)", map: "https://www.google.com/maps?cid=5814346422745768836", img: "", desc: "åˆé¤åœ¨è£¡é¢åƒã€‚", personal: "" },
            { time: "17:30", type: "transport", title: "AirBnB æ°‘å®¿ Check-in", map: "https://www.google.com/maps/place/Daffitto%E6%8A%BC%E4%B8%8AI/@35.7105612,139.8061448,16.3z/data=!4m6!3m5!1s0x60188f004bd5864f:0x7d63e7887305d08e!8m2!3d35.7144156!4d139.8069057!16s%2Fg%2F11y02lrr1b?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "æ­ä¹˜å·´å£«æŠµé”ã€‚", personal: "" },
            { time: "18:30", type: "restaurant", title: "æ™šé¤ - æ·ºè‰", map: "https://www.google.com/maps/search/Lawson+Kawaguchiko+Station0", img: "", desc: "æ·ºè‰å€ç”¨é¤ã€‚", personal: "" },
            { time: "19:30", type: "spot", title: "é›·é–€", map: "https://www.google.com/maps/search/Lawson+Kawaguchiko+Station1", img: "", desc: "å¤œå·¡é›·é–€ã€‚", personal: "" },
            { time: "21:00", type: "spot", title: "LIFE æŠ¼ä¸Šé§…å‰åº—", map: "https://www.google.com/maps/search/Lawson+Kawaguchiko+Station2", img: "", desc: "24:00 é—œé–€ã€‚", personal: "è²·éºµåŒ…ç•¶æ˜å¤©æ—©é¤ã€‚" }
          ]
        },
        {
          day: 4,
          date: "2026-03-17",
          items: [
            { time: "10:00", type: "spot", title: "æ±äº¬è¿ªå£«å°¼", map: "https://www.google.com/maps/search/Lawson+Kawaguchiko+Station3", img: "", desc: "æ­ä¹˜åœ°éµå‰å¾€ã€‚", personal: "åˆé¤äººå‡ï¼š$500 TWDã€‚" },
            { time: "20:00", type: "restaurant", title: "éŠ€åº§ ç¯ å¤§æ‰‹ç”ºåº—", map: "https://www.google.com/maps/place/%E9%8A%80%E5%BA%A7+%E7%AF%9D+%E5%A4%A7%E6%89%8B%E7%94%BA%E5%BA%97/@35.6884692,139.7645297,17z/data=!3m2!4b1!5s0x60188b863eb82967:0xfb353771169d1f88!4m6!3m5!1s0x60188c065b3f31e9:0xb1787c87de002442!8m2!3d35.6884692!4d139.7645297!16s%2Fg%2F11bzypbmqn?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "ç±³å…¶æ—é›ç™½æ¹¯æ‹‰éºµã€‚", personal: "äººå‡ï¼š$300 TWDã€‚" }
          ]
        },
        {
          day: 5,
          date: "2026-03-18",
          items: [
            { time: "11:30", type: "restaurant", title: "äººå½¢ç”ºä»ŠåŠ éŠ€åº§åº—", map: "https://www.google.com/maps/search/Lawson+Kawaguchiko+Station4", img: "", desc: "é ‚ç´šå£½å–œç‡’ã€‚", personal: "äººå‡ï¼š$2000 TWDã€‚" },
            { time: "13:30", type: "spot", title: "æ±äº¬éµå¡”", map: "https://www.google.com/maps/search/Lawson+Kawaguchiko+Station5", img: "", desc: "ç¶“å…¸åœ°æ¨™ã€‚", personal: "" },
            { time: "15:00", type: "spot", title: "é«˜è¼ª GATEWAY CITY", map: "https://www.google.com/maps?cid=14394245430464429321", img: "", desc: "æ–°é–‹ç™¼ç‰¹å€ã€‚", personal: "" },
            { time: "16:00", type: "spot", title: "New Balance éŠ€åº§åº—", map: "https://www.google.com/maps/place/New+Balance+%E9%8A%80%E5%BA%A7%E5%BA%97/@35.6703834,139.7624117,15.5z/data=!3m1!5s0x60188be131dc9a0f:0xb8a9de7a3285bc3f!4m10!1m2!2m1!1snew+balance!3m6!1s0x60188be131855555:0x42d59ea1e2bfa0a6!8m2!3d35.6713729!4d139.7682031!15sCgtuZXcgYmFsYW5jZSIDiAEBWg0iC25ldyBiYWxhbmNlkgEUc3BvcnRpbmdfZ29vZHNfc3RvcmXgAQA!16s%2Fg%2F11dfjddm9z?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "é‹å‹•é‹æ¡è²·ã€‚", personal: "" },
            { time: "17:00", type: "restaurant", title: "GINZA TONKATSU SAITO è±¬æ’", map: "https://www.google.com/maps?cid=13172906255984762323", img: "", desc: "äººå‡ï¼š$700 TWDã€‚", personal: "" },
            { time: "20:00", type: "spot", title: "Uniqlo éŠ€åº§æ——è‰¦åº—", map: "https://www.google.com/maps/place/Uniqlo+Ginza+Flagship+Store/@35.6669282,139.7571135,15.5z/data=!3m1!5s0x60188be616e4127b:0xb343ddf465dffb5!4m10!1m2!2m1!1suniqlo!3m6!1s0x60188be66e07d36f:0x45e536859ebe18d3!8m2!3d35.6702448!4d139.7634686!15sCgZ1bmlxbG8iA4gBAVoIIgZ1bmlxbG-SAQ5jbG90aGVzX21hcmtldOABAA!16s%2Fg%2F1th8736p?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "å…¨çƒæœ€å¤§æ——è‰¦åº—ã€‚", personal: "" }
          ]
        },
        {
          day: 6,
          date: "2026-03-19",
          items: [
            { time: "11:30", type: "restaurant", title: "Sweet Check", map: "https://www.google.com/maps/place/Sweet+Check/@35.6648961,139.7136236,14z/data=!4m18!1m9!3m8!1s0x60188b001ee3404f:0x79d3f6d78f544eb2!2sSweet+Check!8m2!3d35.6648961!4d139.7136236!9m1!1b1!16s%2Fg%2F11vqzl22_f!3m7!1s0x60188b001ee3404f:0x79d3f6d78f544eb2!8m2!3d35.6648961!4d139.7136236!9m1!1b1!16s%2Fg%2F11vqzl22_f?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "ç”œé»ä¸‹åˆèŒ¶ã€‚", personal: "äººå‡ï¼š$500 TWDã€‚" },
            { time: "13:00", type: "spot", title: "niko and ... TOKYO", map: "https://www.google.com/maps/place/niko+and+...+TOKYO/@35.666114,139.7033371,17.96z/data=!3m1!5s0x60188ca430fb2c05:0x4199e9589da31cc7!4m6!3m5!1s0x60188ca69da70001:0x39738a0debb677bf!8m2!3d35.6665838!4d139.7044202!16s%2Fg%2F11b6s66b8q?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "åŸå®¿ç”Ÿæ´»é›œè²¨ã€‚", personal: "" },
            { time: "14:00", type: "restaurant", title: "Kenyan Shibuya (å¥¶èŒ¶)", map: "https://www.google.com/maps/place/Kenyan+Shibuya/@35.6638151,139.6999153,17z/data=!3m1!4b1!4m6!3m5!1s0x60188ca8ca4ae3b3:0x11a910c14454ccbc!8m2!3d35.6638151!4d139.6999153!16s%2Fg%2F1tg50dyd?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "è‰¾åˆ©å¥¶èŒ¶ã€‚", personal: "" },
            { time: "15:00", type: "spot", title: "FREAK'S STORE Shibuya", map: "https://www.google.com/maps/place/FREAK'S+STORE+Shibuya/@35.6628882,139.7002868,21z/data=!3m1!5s0x60188ca896754d61:0xb69bf0e2782ee24a!4m6!3m5!1s0x60188ca895c73753:0xb4a267f60a5cbca4!8m2!3d35.6629562!4d139.7004055!16s%2Fg%2F1tnpk_c_?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "æœé£¾å“ç‰Œåº—ã€‚", personal: "" },
            { time: "16:00", type: "spot", title: "æ¾€è°· SKY", map: "https://www.google.com/maps?cid=8067212359343678579", img: "", desc: "é«˜ç©ºå±•æœ›å°ã€‚", personal: "" }
          ]
        },
        {
          day: 7,
          date: "2026-03-20",
          items: [
            { time: "10:00", type: "spot", title: "ç©å…·åº— Yamashiroya", map: "https://www.google.com/maps/place/%E7%8E%A9%E5%85%B7%E5%BA%97+Yamashiroya/@35.7113323,139.7727318,17z/data=!3m1!4b1!4m6!3m5!1s0x60188e9e5f5ed73f:0x9710bfada7b2ccf1!8m2!3d35.711328!4d139.7753067!16s%2Fg%2F11b6_p_q71?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "ä¸Šé‡ç«™å‰ç©å…·å¤§æ¨“ã€‚", personal: "" },
            { time: "11:00", type: "spot", title: "ä¸Šé‡æ©è³œå…¬åœ’", map: "https://www.google.com/maps/place/%E4%B8%8A%E9%87%8E%E6%81%A9%E8%B3%9C%E5%85%AC%E5%9C%92/@35.7146853,139.769852,16.25z/data=!4m6!3m5!1s0x60188e9b45906ac3:0xb1cb3623124e645a!8m2!3d35.7147557!4d139.7734312!16zL20vMDJ5NWdk?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "çœ‹æ«»èŠ±ã€‚", personal: "" },
            { time: "15:00", type: "restaurant", title: "è—å‰ ASAGE CAFE", map: "https://www.google.com/maps/place/ASAGE+CAFE-%E3%82%AB%E3%83%AF%E3%83%89%E3%82%B3CAFE+%26+BAR-+%E6%B5%85%E8%8D%89%E8%94%B5%E5%89%8D/@35.7066728,139.7929265,16.21z/data=!4m6!3m5!1s0x60188fb68745fa1d:0x81f194fd425d1bdf!8m2!3d35.7052553!4d139.7946272!16s%2Fg%2F11s_vxwr4x?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "æ·ºè‰è—å‰æ²³ç•”å’–å•¡ã€‚", personal: "" },
            { time: "16:00", type: "spot", title: "è—å‰é€›é€› (å¯éº—éœ²/ç¥ç¤¾)", map: "https://www.google.com/maps/place/Mizukiya+Baba+Shoten/@35.7027365,139.7896724,17z/data=!3m1!4b1!4m6!3m5!1s0x60188eb718fd3b7b:0x6a70a51c798a02d1!8m2!3d35.7027365!4d139.7896724!16s%2Fg%2F11b6ns6dmh?entry=ttu&g_ep=EgoyMDI2MDIyNS4wIKXMDSoASAFQAw%3D%3D", img: "", desc: "Mizukiya Baba Shotenã€KURAMAE CANNELEã€è—å‰ç¥ç¤¾ã€‚", personal: "" }
          ]
        }
      ];

      let tripData = [];

      function renderApp() {
        const container = document.getElementById("app");
        container.innerHTML = tripData
          .map((day, dIdx) => {
            let cardsHtml = "";
            day.items.forEach((item, iIdx) => {
              cardsHtml += `
                <div class="card card-${item.type} mb-3" onclick="openView(${dIdx}, ${iIdx})">
                  <div class="flex justify-between items-start">
                    <span class="bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full text-[10px] font-bold">${item.time}</span>
                    <div class="flex gap-2">
                      ${item.map ? `<a href="${item.map}" target="_blank" onclick="event.stopPropagation()" class="map-btn"><i class="fas fa-location-arrow"></i>åœ°åœ–</a>` : ""}
                      <button class="text-gray-300 p-1" onclick="openEdit(event, ${dIdx}, ${iIdx})"><i class="fas fa-pen text-xs"></i></button>
                    </div>
                  </div>
                  <h3 class="text-lg font-bold mt-1 text-gray-800">${iconMap[item.type]} ${item.title}</h3>
                  ${item.personal ? `<div class="personal-note-preview"><i class="fas fa-lightbulb mr-1"></i>${item.personal}</div>` : ""}
                </div>`;
            });
            return `<div class="mb-10 day-group"><h2 class="text-xl font-bold text-pink-500 mb-4">ğŸ“… Day ${day.day} (${day.date})</h2><div>${cardsHtml}</div></div>`;
          })
          .join("");
        saveLocal();
      }

      function openView(d, i) {
        const item = tripData[d].items[i];
        document.getElementById("vImg").src = item.img || "";
        document.getElementById("vTitle").innerText = item.title;
        document.getElementById("vTime").innerText = item.time;
        document.getElementById("vTypeDisp").innerText = typeLabel[item.type];
        document.getElementById("vDesc").innerText = item.desc || "";
        document.getElementById("vPersonal").innerText = item.personal || "";
        const mapBtn = document.getElementById("vMapLink");
        mapBtn.href = item.map || "#";
        mapBtn.style.display = item.map ? "flex" : "none";
        document.getElementById("viewPopup").classList.add("active");
      }

      function openEdit(e, d, i) {
        e.stopPropagation();
        editingIndices = { d, i };
        const item = tripData[d].items[i];
        document.getElementById("eImg").value = item.img || "";
        document.getElementById("eMap").value = item.map || "";
        document.getElementById("eTitle").value = item.title;
        document.getElementById("eTime").value = item.time;
        document.getElementById("eType").value = item.type;
        document.getElementById("eDesc").value = item.desc || "";
        document.getElementById("ePersonal").value = item.personal || "";
        document.getElementById("editPopup").classList.add("active");
      }

      function saveChanges() {
        const { d, i } = editingIndices;
        const item = tripData[d].items[i];
        item.img = document.getElementById("eImg").value;
        item.map = document.getElementById("eMap").value;
        item.title = document.getElementById("eTitle").value;
        item.time = document.getElementById("eTime").value;
        item.type = document.getElementById("eType").value;
        item.desc = document.getElementById("eDesc").value;
        item.personal = document.getElementById("ePersonal").value;
        renderApp();
        closePopups();
      }

      function closePopups() {
        document.querySelectorAll(".popup-bg").forEach((p) => p.classList.remove("active"));
      }

      function toggleJSON() {
        document.getElementById("jsonInput").value = JSON.stringify(tripData, null, 2);
        document.getElementById("jsonPopup").classList.toggle("active");
      }

      function importData() {
        try {
          tripData = JSON.parse(document.getElementById("jsonInput").value);
          renderApp();
          closePopups();
        } catch (e) { alert("JSON æ ¼å¼éŒ¯èª¤"); }
      }

      function saveLocal() {
        localStorage.setItem("trip_data_v6_0", JSON.stringify(tripData));
      }

      window.onload = () => {
        const saved = localStorage.getItem("trip_data_v6_0");
        tripData = saved ? JSON.parse(saved) : tripDataTemplate;
        renderApp();
      };
    </script>
  </body>
</html>
